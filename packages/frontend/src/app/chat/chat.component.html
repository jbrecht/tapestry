<div class="chat-container">
  <div class="message-list" #messageList>
    @for (msg of store.messages(); track $index) {
      <div class="message" [class]="msg.role">
        <span class="label">{{ msg.role === 'user' ? 'You' : 'Loom' }}</span>
        <p>{{ msg.content }}</p>
      </div>
    }

    @if (loomResource.isLoading()) {
      <div class="message assistant loading">
        <span>The Loom is spinning...</span>
      </div>
    }
  </div>

  <div class="input-area">
    <mat-form-field appearance="outline" class="chat-input-field">
      <mat-label>Weave your tale...</mat-label>
      <textarea matInput
                cdkTextareaAutosize
                cdkAutosizeMinRows="3"
                cdkAutosizeMaxRows="6"
                [(ngModel)]="userInput"
                (keydown.enter)="onEnter($event)"
                [disabled]="loomResource.isLoading()"></textarea>
      <button mat-icon-button matSuffix (click)="toggleListening()" [color]="isListening() ? 'warn' : ''" [class.listening]="isListening()" [disabled]="loomResource.isLoading()" class="mic-button">
        <mat-icon>{{ isListening() ? 'mic' : 'mic_none' }}</mat-icon>
      </button>
      <button mat-icon-button matSuffix (click)="onSend()" [disabled]="loomResource.isLoading()">
        <mat-icon>send</mat-icon>
      </button>
    </mat-form-field>
  </div>
</div>